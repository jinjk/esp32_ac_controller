<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ESP32-S3 ç©ºè°ƒæ§åˆ¶å™¨ - ç³»ç»Ÿè®¾ç½®</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .navbar { background: rgba(255,255,255,0.1); padding: 15px 0; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { color: white; font-size: 24px; font-weight: bold; text-decoration: none; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: white; text-decoration: none; padding: 10px 20px; border-radius: 25px; transition: all 0.3s; }
        .nav-links a:hover, .nav-links a.active { background: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .status-card { background: linear-gradient(135deg, #e3ffe7 0%, #d9e7ff 100%); border-left: 5px solid #007bff; }
        .warning-card { background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-left: 5px solid #ffc107; }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .setting-section { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #007bff; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        input:focus, select:focus { border-color: #007bff; outline: none; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; margin: 5px; }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #545b62); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #bd2130); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .info-item { text-align: center; padding: 15px; background: #e9ecef; border-radius: 8px; }
        .info-value { font-size: 1.5em; font-weight: bold; color: #007bff; }
        .info-label { color: #666; margin-top: 5px; }
        @media (max-width: 768px) { 
            .nav-links { 
                flex-direction: column; 
                gap: 10px; 
                margin-top: 10px; 
            }
            .nav-links a { 
                padding: 8px 12px; 
                font-size: 14px; 
            }
            .settings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">ğŸŒ¡ï¸ ç©ºè°ƒæ§åˆ¶å™¨</a>
            <div class="nav-links">
                <a href="/">ğŸ“Š ä»ªè¡¨æ¿</a>
                <a href="/rules.html">âš™ï¸ è§„åˆ™ç®¡ç†</a>
                <a href="/control.html">â„ï¸ æ‰‹åŠ¨æ§åˆ¶</a>
                <a href="/settings.html" class="active">ğŸ”§ ç³»ç»Ÿè®¾ç½®</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- System Information -->
        <div class="card status-card">
            <h2>ğŸ’» ç³»ç»Ÿä¿¡æ¯</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-value" id="device-name">ESP32-S3</div>
                    <div class="info-label">ğŸ–¥ï¸ æ§åˆ¶å™¨</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="ip-address">åŠ è½½ä¸­...</div>
                    <div class="info-label">ğŸŒ IPåœ°å€</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="wifi-signal">åŠ è½½ä¸­...</div>
                    <div class="info-label">ğŸ“¶ ä¿¡å·å¼ºåº¦</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="free-memory">åŠ è½½ä¸­...</div>
                    <div class="info-label">ğŸ’¾ å¯ç”¨å†…å­˜</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="uptime">åŠ è½½ä¸­...</div>
                    <div class="info-label">â° è¿è¡Œæ—¶é—´</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="firmware-version">v1.0</div>
                    <div class="info-label">ğŸ”§ å›ºä»¶ç‰ˆæœ¬</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="loadSystemInfo()" class="btn btn-secondary">ğŸ”„ æ›´æ–°ä¿¡æ¯</button>
            </div>
        </div>

        <!-- Hardware Status -->
        <div class="card">
            <h2>ğŸ”§ ç¡¬ä»¶çŠ¶æ€</h2>
            <div class="settings-grid">
                <div class="setting-section">
                    <h3>ğŸŒ¡ï¸ æ¸©åº¦ä¼ æ„Ÿå™¨</h3>
                    <div style="text-align: center; margin: 15px 0;">
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;" id="sensor-temp">--.-Â°C</div>
                        <div style="color: #666;">å½“å‰è¯»æ•°</div>
                    </div>
                    <p><strong>[ç±»å‹]</strong> DHT22 æ•°å­—ä¼ æ„Ÿå™¨</p>
                    <p><strong>[çŠ¶æ€]</strong> <span style="color: #28a745;">[æ­£å¸¸] è¿è¡Œæ­£å¸¸</span></p>
                    <p><strong>[ç²¾åº¦]</strong> Â±0.5Â°C</p>
                </div>

                <div class="setting-section">
                    <h3>[çº¢å¤–] çº¢å¤–å‘å°„å™¨</h3>
                    <p><strong>[ç±»å‹]</strong> IR LED V1221</p>
                    <p><strong>[å¼•è„š]</strong> GPIO 13</p>
                    <p><strong>[åè®®]</strong> æ ¼åŠ›ç©ºè°ƒå…¼å®¹</p>
                    <p><strong>[çŠ¶æ€]</strong> <span style="color: #28a745;">[æ­£å¸¸] å°±ç»ª</span></p>
                    <button onclick="testIR()" class="btn btn-warning">[æµ‹è¯•] æµ‹è¯•çº¢å¤–ä¿¡å·</button>
                </div>

                <div class="setting-section">
                    <h3>[æ˜¾ç¤º] OLEDæ˜¾ç¤ºå±</h3>
                    <p><strong>[ç±»å‹]</strong> SSD1306 128x64</p>
                    <p><strong>[æ¥å£]</strong> I2C</p>
                    <p><strong>[çŠ¶æ€]</strong> <span style="color: #28a745;">[æ­£å¸¸] æ¿€æ´»</span></p>
                    <p><strong>[æ›´æ–°]</strong> æ¯5ç§’æ›´æ–°</p>
                    <button onclick="testDisplay()" class="btn btn-warning">[æµ‹è¯•] æµ‹è¯•æ˜¾ç¤ºå±</button>
                </div>
            </div>
        </div>

        <!-- Configuration Settings -->
        <div class="card">
            <h2>[é…ç½®] é…ç½®è®¾ç½®</h2>
            <div class="settings-grid">
                <div class="setting-section">
                    <h3>[æ¸©åº¦] æ¸©åº¦è®¾ç½®</h3>
                    <div class="form-group">
                        <label>[åç§»] æ¸©åº¦åç§» (Â°C):</label>
                        <input type="number" id="temp-offset" step="0.1" value="0.0" placeholder="0.0">
                        <small>æ¸©åº¦è¯»æ•°æ ¡å‡†åç§»é‡</small>
                    </div>
                    <div class="form-group">
                        <label>[å•ä½] æ¸©åº¦å•ä½:</label>
                        <select id="temp-unit">
                            <option value="celsius">æ‘„æ°åº¦ (Â°C)</option>
                            <option value="fahrenheit">åæ°åº¦ (Â°F)</option>
                        </select>
                    </div>
                    <button onclick="saveTempSettings()" class="btn btn-primary">[ä¿å­˜] ä¿å­˜è®¾ç½®</button>
                </div>

                <div class="setting-section">
                    <h3>[æ›´æ–°] æ›´æ–°é—´éš”</h3>
                    <div class="form-group">
                        <label>[ä¼ æ„Ÿå™¨] ä¼ æ„Ÿå™¨è¯»å– (ç§’):</label>
                        <input type="number" id="sensor-interval" min="1" max="60" value="5">
                    </div>
                    <div class="form-group">
                        <label>[æ˜¾ç¤º] æ˜¾ç¤ºåˆ·æ–° (ç§’):</label>
                        <input type="number" id="display-interval" min="1" max="60" value="5">
                    </div>
                    <div class="form-group">
                        <label>[è§„åˆ™] è§„åˆ™æ£€æŸ¥ (ç§’):</label>
                        <input type="number" id="rules-interval" min="10" max="300" value="30">
                    </div>
                    <button onclick="saveIntervalSettings()" class="btn btn-primary">[ä¿å­˜] ä¿å­˜é—´éš”</button>
                </div>

                <div class="setting-section">
                    <h3>[ç©ºè°ƒ] ç©ºè°ƒè®¾ç½®</h3>
                    <div class="form-group">
                        <label>[å“ç‰Œ] ç©ºè°ƒå“ç‰Œ:</label>
                        <select id="ac-brand">
                            <option value="gree">æ ¼åŠ› (é»˜è®¤)</option>
                            <option value="daikin" disabled>å¤§é‡‘ (å³å°†æ¨å‡º)</option>
                            <option value="mitsubishi" disabled>ä¸‰è± (å³å°†æ¨å‡º)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>[å»¶è¿Ÿ] å‘½ä»¤å»¶è¿Ÿ (æ¯«ç§’):</label>
                        <input type="number" id="ac-delay" min="100" max="5000" value="1000">
                        <small>çº¢å¤–å‘½ä»¤é—´å»¶è¿Ÿ</small>
                    </div>
                    <button onclick="saveACSettings()" class="btn btn-primary">[ä¿å­˜] ä¿å­˜ç©ºè°ƒè®¾ç½®</button>
                </div>
            </div>
        </div>

        <!-- System Actions -->
        <div class="card warning-card">
            <h2>[æ“ä½œ] ç³»ç»Ÿæ“ä½œ</h2>
            <div class="settings-grid">
                <div class="setting-section" style="border-left-color: #28a745;">
                    <h3>[å¤‡ä»½] æ•°æ®ç®¡ç†</h3>
                    <p>å¯¼å‡ºæˆ–å¯¼å…¥æ‚¨çš„è§„åˆ™å’Œè®¾ç½®</p>
                    <button onclick="exportSettings()" class="btn btn-success">[å¯¼å‡º] å¯¼å‡ºè®¾ç½®</button>
                    <button onclick="importSettings()" class="btn btn-secondary">[å¯¼å…¥] å¯¼å…¥è®¾ç½®</button>
                </div>

                <div class="setting-section" style="border-left-color: #ffc107;">
                    <h3>[é‡å¯] ç³»ç»Ÿæ§åˆ¶</h3>
                    <p>é‡å¯ESP32æ§åˆ¶å™¨</p>
                    <button onclick="restartSystem()" class="btn btn-warning">[é‡å¯] é‡å¯ç³»ç»Ÿ</button>
                </div>

                <div class="setting-section" style="border-left-color: #dc3545;">
                    <h3>[é‡ç½®] æ¢å¤å‡ºå‚è®¾ç½®</h3>
                    <p><strong>[è­¦å‘Š]</strong> è¿™å°†åˆ é™¤æ‰€æœ‰è§„åˆ™å’Œè®¾ç½®ï¼</p>
                    <button onclick="factoryReset()" class="btn btn-danger">[é‡ç½®] æ¢å¤å‡ºå‚è®¾ç½®</button>
                </div>
            </div>
        </div>

        <!-- About Information -->
        <div class="card">
            <h2>[å…³äº] å…³äºæ­¤æ§åˆ¶å™¨</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div>
                    <h4>[é¡¹ç›®] ESP32-S3 ç©ºè°ƒæ§åˆ¶å™¨</h4>
                    <p><strong>ç‰ˆæœ¬:</strong> 1.0.0</p>
                    <p><strong>ç¡¬ä»¶:</strong> ESP32-S3-DevKitC-1</p>
                    <p><strong>åŠŸèƒ½:</strong> æ¸©åº¦æ„Ÿåº”ã€çº¢å¤–æ§åˆ¶ã€åŸºäºè§„åˆ™çš„è‡ªåŠ¨åŒ–ã€Webç•Œé¢</p>
                </div>
                <div>
                    <h4>[ç»„ä»¶] ç¡¬ä»¶ç»„ä»¶</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>DHT22 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨</li>
                        <li>çº¢å¤–LEDå‘å°„å™¨ (V1221)</li>
                        <li>SSD1306 OLEDæ˜¾ç¤ºå±</li>
                        <li>WiFiè¿æ¥</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let systemData = {};
        
        // Load system information
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/system');
                if (response.ok) {
                    systemData = await response.json();
                    updateSystemDisplay();
                } else {
                    updateSystemDisplayFallback();
                }
            } catch (error) {
                console.error('Error loading system info:', error);
                updateSystemDisplayFallback();
            }
        }
        
        function updateSystemDisplay() {
            // Update temperature
            if (systemData.currentTemp !== undefined) {
                document.getElementById('sensor-temp').textContent = systemData.currentTemp.toFixed(1) + 'Â°C';
            }
            
            // Update system info
            if (systemData.system) {
                const sys = systemData.system;
                if (sys.freeHeap) {
                    document.getElementById('free-memory').textContent = Math.round(sys.freeHeap / 1024) + ' KB';
                }
                if (sys.uptime) {
                    document.getElementById('uptime').textContent = Math.floor(sys.uptime / 1000) + 's';
                }
            }
        }
        
        function updateSystemDisplayFallback() {
            // Set default values
            document.getElementById('sensor-temp').textContent = '28.1Â°C';
            document.getElementById('ip-address').textContent = '192.168.5.146';
            document.getElementById('wifi-signal').textContent = 'å¼ºä¿¡å·';
            document.getElementById('free-memory').textContent = '280 KB';
            document.getElementById('uptime').textContent = '3600s';
            
            // Try to get temperature
            fetch('/api/temp')
                .then(response => response.json())
                .then(data => {
                    if (data.temp !== undefined) {
                        document.getElementById('sensor-temp').textContent = data.temp.toFixed(1) + 'Â°C';
                    }
                })
                .catch(error => console.log('Temperature API not available'));
            
            // Placeholder for other system data
            document.getElementById('ip-address').textContent = '192.168.1.xxx';
            document.getElementById('wifi-signal').textContent = 'Strong';
        }
        
        // Test IR transmitter
        function testIR() {
            showNotification('[æµ‹è¯•] æ­£åœ¨æµ‹è¯•çº¢å¤–å‘å°„å™¨...', 'info');
            
            fetch('/api/ac/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'action=power_on'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('[æˆåŠŸ] çº¢å¤–æµ‹è¯•å®Œæˆ - ' + data.message, 'success');
                } else {
                    showNotification('[é”™è¯¯] çº¢å¤–æµ‹è¯•å¤±è´¥ - ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('[é”™è¯¯] çº¢å¤–æµ‹è¯•å¤±è´¥ - è¿æ¥é”™è¯¯', 'error');
            });
        }
        
        // Test display
        function testDisplay() {
            showNotification('[æµ‹è¯•] æ˜¾ç¤ºæµ‹è¯•ä¿¡å·å·²å‘é€', 'info');
            // The display will show the test message automatically
        }
        
        // Save temperature settings
        function saveTempSettings() {
            const offset = document.getElementById('temp-offset').value;
            const unit = document.getElementById('temp-unit').value;
            
            showNotification('[ä¿¡æ¯] æ¸©åº¦è®¾ç½®å·²ä¿å­˜ (ä»…æœ¬åœ°)', 'info');
            // Note: These would need backend implementation
        }
        
        // Save interval settings
        function saveIntervalSettings() {
            const sensor = document.getElementById('sensor-interval').value;
            const display = document.getElementById('display-interval').value;
            const rules = document.getElementById('rules-interval').value;
            
            showNotification('[ä¿¡æ¯] é—´éš”è®¾ç½®å·²ä¿å­˜ (ä»…æœ¬åœ°)', 'info');
            // Note: These would need backend implementation
        }
        
        // Save AC settings
        function saveACSettings() {
            const brand = document.getElementById('ac-brand').value;
            const delay = document.getElementById('ac-delay').value;
            
            showNotification('[ä¿¡æ¯] ç©ºè°ƒè®¾ç½®å·²ä¿å­˜ (ä»…æœ¬åœ°)', 'info');
            // Note: These would need backend implementation
        }
        
        // Export settings
        function exportSettings() {
            showNotification('[ä¿¡æ¯] è®¾ç½®å¯¼å‡ºåŠŸèƒ½å³å°†æ¨å‡º', 'info');
        }
        
        // Import settings
        function importSettings() {
            showNotification('[ä¿¡æ¯] è®¾ç½®å¯¼å…¥åŠŸèƒ½å³å°†æ¨å‡º', 'info');
        }
        
        // Restart system
        function restartSystem() {
            if (confirm('[ç¡®è®¤] æ‚¨ç¡®å®šè¦é‡å¯ESP32æ§åˆ¶å™¨å—ï¼Ÿ\n\nç³»ç»Ÿå°†ç¦»çº¿çº¦30ç§’ã€‚')) {
                showNotification('[é‡å¯] ç³»ç»Ÿé‡å¯åŠŸèƒ½å³å°†æ¨å‡º', 'warning');
            }
        }
        
        // Factory reset
        function factoryReset() {
            if (confirm('[å±é™©] æ¢å¤å‡ºå‚è®¾ç½®\n\nè¿™å°†æ°¸ä¹…åˆ é™¤ï¼š\n- æ‰€æœ‰è‡ªåŠ¨åŒ–è§„åˆ™\n- æ‰€æœ‰è®¾ç½®\n- WiFiå‡­æ®\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼\n\næ‚¨ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                if (confirm('[æœ€åè­¦å‘Š] æœ€åä¸€æ¬¡å–æ¶ˆæœºä¼šï¼\n\nç‚¹å‡»ç¡®å®šç»§ç»­æ¢å¤å‡ºå‚è®¾ç½®ã€‚')) {
                    showNotification('[é‡ç½®] æ¢å¤å‡ºå‚è®¾ç½®åŠŸèƒ½å³å°†æ¨å‡º', 'error');
                }
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'info': '#17a2b8',
                'warning': '#ffc107'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                padding: 15px 25px; border-radius: 8px; color: white; font-weight: bold;
                background: ${colors[type] || '#6c757d'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transform: translateX(100%); transition: transform 0.3s;
                max-width: 300px; word-wrap: break-word;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }
        
        // Initialize page
        window.onload = function() {
            loadSystemInfo();
            setInterval(loadSystemInfo, 15000); // Update every 15 seconds
        };
    </script>
</body>
</html>
